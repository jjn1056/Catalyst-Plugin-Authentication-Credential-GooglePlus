<!DOCTYPE HTML>
<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="google-signin-clientid" content="YOUR GOOGLE API KEY GOES HERE" />
<meta name="google-signin-scope" content="https://www.googleapis.com/auth/plus.profile.emails.read" />
<meta name="google-signin-requestvisibleactions" content="http://schema.org/AddAction" />
<meta name="google-signin-cookiepolicy" content="single_host_origin" />
<meta name="google-signin-openidrealm" content="YOUR WEBSITE GOES HERE" />


<script src="https://apis.google.com/js/client:platform.js?onload=render" async defer>
</script>
<script>
 /* Executed when the APIs finish loading */
 function render() {

    document.getElementById('signinButton').disabled = false;
   var additionalParams = {
     'callback': googleSignIn
   };

   // Attach a click listener to a button to trigger the flow.
   var signinButton = document.getElementById('signinButton');
   signinButton.addEventListener('click', function() {
     gapi.auth.signIn(additionalParams); // Will use page level configuration
   });

    $('#login_actions').accordion();
    $('.login_button').button();
    $('#submit').button();
    
    var status = '';
    if( status == 'Logged in!' ) {
        setInterval( function ( e ) {
            window.opener.location.reload(true);
            window.close();
            e.preventDefault();
        }, 2000 );
    }
 }
</script>
    <script type="text/javascript">

    function googleSignIn(authResult) {
        if (authResult['status']['signed_in']) {
            document.getElementById('signinButton').disabled = true;
            gapi.client.load('plus', 'v1', function apiClientLoaded() {
                gapi.client.plus.people.get({ userId: 'me'}).execute(function infoRetrieved(resp) {
                    var primaryEmail;
                    for (var i = 0; i < resp.emails.length; i++) {
                        if (resp.emails[i].type === 'account') {
                            primaryEmail = resp.emails[i].value;
                        }
                    }

                    dataRetrieved(authResult, primaryEmail);
                });
            });
        } else {
            console.log("Error", authResult);
        }
    }

    function dataRetrieved(login, email) {
        console.log(email);
        console.log(login.id_token);

        document.getElementById('email').value = email;
        document.getElementById('id_token').value = login.id_token;
        document.getElementById('google_form').submit();
    }

    </script>

    <title></title>
  </head>
  <body>

<div id="login_actions">
    <h3><a href="#">Sign in with Google</a></h3>
    <div>
        <p>If you have a Google account, you may use it to sign in.</p>

        <button disabled id="signinButton">Sign in with Google</button>
        <form id="google_form" action="/login" method="post">
            <input id='email' name='email' value='' type='hidden' />
            <input id='id_token' name='id_token' value='' type='hidden' />
        </form>
    </div>
</div>

  </body>
</html>


